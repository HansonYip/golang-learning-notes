# 包

Go语言的代码通过包（package）组织，包类似于其它语言里的库（libraries）或者模块（modules）。一个包由位于单个目录下的一个或多个.go源代码文件组成, 目录定义包的作用。这种包系统设计的目的都是为了简化大型程序的设计和维护工作，通过将一组相关的特性放进一个独立的单元以便于理解和更新，在每个单元更新的同时保持和程序中其它单元的相对独立性，支持模块化、封装、单独编译和代码重用。

包还可以让我们通过控制哪些名字是外部可见的来隐藏内部实现信息。在Go语言中，一个简单的规则是：如果一个名字是大写字母开头的，那么该名字是导出的。

main包是比较特殊的包。它定义了一个独立可执行的程序，而不是一个库。在`main`包里的`main()`函数也很特殊，它是整个程序执行时的入口。

## **包声明和命名**

在每个Go语言源文件的开头都必须有包声明语句。包声明语句的主要目的是确定当前包被其它包导入时默认的标识符（也称为包名）。通常来说，默认的包名就是包导入路径名的最后一段，但也存在例外情况，如`main`包。

每个包是由一个全局唯一的字符串所标识的导入路径定位。导入路径最好是全球唯一的，为了避免冲突，所有非标准库包的导入路径建议以所在组织的互联网域名为前缀。

包命名约定：

* 一般要用短小的包名，但也不能太短导致难以理解；
* 包名一般采用单数的形式；
* 要避免包名有其它的含义；
* 当设计一个包的时候，需要考虑包名和成员名两个部分如何很好地配合。

## **导入声明**

在一个Go语言源文件包声明语句之后，其它非导入声明语句之前，包含零到多个导入包声明语句。导入声明语法如下：

```go
// 形式一
import (
    "导入路径1"
    "导入路径2"
    ...
)

// 形式二
import "导入路径1"
import "导入路径2"
import ...
```

* 导入形式一和形式二是等价的，形式一更为常见；
* 导入的包之间可以通过添加空行来将来自不同组织的包独自分组；
* 若导入两个有着名字相同的包时，可通过包重命名解决，格式如下：

  ```go
  import (
    新包名 "导入路径"
  )
  ```

> 严格要求避免了程序开发过程中引入未使用的包。如果只是导入一个包而并不使用导入的包将会导致一个编译错误。

但是有时候我们只是想利用导入包而产生的副作用：它会计算包级变量的初始化表达式和执行导入包的init初始化函数。这时可以用下划线  _来重命名导入的包。下划线_  为空白标识符，并不能被访问。

## **包的初始化**

每个包在解决依赖的前提下，以导入声明的顺序初始化，每个包只会被初始化一次。初始化工作是自下而上进行的，因此，`main` 包最后被初始化。

包的初始化首先是解决包级变量的依赖顺序，然后按照包级变量声明出现的顺序依次初始化。

对于在包级别声明的变量，可用表达式初始化或者可以用特殊的`init()`初始化函数来实现，每个文件都可以包含多个`init()`初始化函数。

```go
 func init() { /* ... */ }
```

在每个文件中的init初始化函数，在程序开始执行时按照它们声明的顺序被自动调用。

## **包构建**

`go build`命令编译命令行参数指定的每个包。如果包是一个库，则忽略输出结果；这可以用于检测包的可以正确编译的。如果包的名字是`main`，`go build`将调用连接器在当前目录创建一个可执行程序；以导入路径的最后一段作为可执行程序的名字。

每个包可以由它们的导入路径指定，就像前面看到的那样，或者用一个相对目录的路径知指定，相对路径必须以 . 或 .. 开头。如果没有指定参数，那么默认指定为当前目录对应的包。

`go build`命令构建指定的包和它依赖的包，然后丢弃除了最后的可执行文件之外所有的中间编译结果`go install`命令和`go build`命令很相似，但是它会保存每个包的编译成果，而不是将它们都丢弃。被编译的包会被保存到`$GOPATH/pkg`目录下，目录路径和`src`目录路径对应，可执行程序被保存到`$GOPATH/bin`目录。

**TODO**：跨平台交叉编译 [Ego](https://github.com/karalabe/xgo)

